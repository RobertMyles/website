---
title: Mapping Economic Partners with flagfillr
author: Robert Myles McDonnell
date: '2018-02-10'
slug: mapping-economic-partners-with-flagfillr
categories: [R, ggplot2, trade]
tags: []
draft: true
---

`r emo::ji("cocos_islands")` `r emo::ji("christmas_island")` `r emo::ji("portugal")` `r emo::ji("dominican_republic")` `r emo::ji("micronesia")` `r emo::ji("kr")`
Recently I wrote a little package for R called flagfillr (you can read more details [here](https://github.com/RobertMyles/flagfillr)). One of the main reasons I made this is because I had seen a few maps of economic partners, for example this one, from [here](http://drunkeynesian.blogspot.com.br/2017/11/o-que-os-estados-brasileiros-exportam.html):  

![](https://i.imgur.com/6aL6KI9.png)

These types of maps (some more [here](http://www.businessinsider.com/us-state-import-export-international-trade-partner-map-2017-11), of the US) are interesting visual summaries, but they look a little *Excel* to me (sorry, whoever made it!). I thought I could spice them up with flags, cos hey, who doesn't like cool flags (like Bhutan, `r emo::ji("bhutan")`, awesome!)

## Enter `flagfillr`

With flagfillr, the above map can easily be created. Once you have a data.frame of the data (here I refer to it as `DF`), you can do it with one line: 
```{r, eval = F}
flagfillr::flag_fillr_data(data = DF, country = "Brazil", resolution = "large",
                           size = "250")
```

Which, if your data corresponds to the map above, will give you this: 

![](https://i.imgur.com/qbNUhbY.png)


## Mapping Economic Partners

So how can you do this for another country? Let's take the example of Australia, from data available [here](http://dfat.gov.au/trade/resources/trade-at-a-glance/Pages/goods-by-state.aspx). First of all, we'll need to put our data into a dataframe, preferably with columns named `country`, `state` and `partner`, just to keep things simple. Simple is good. I'll use `dplyr` here (don't forget you'll have to install flagfillr, see [here](https://github.com/RobertMyles/flagfillr). Since Australia's main trade partners by state are basically China and Japan, let's choose the *third* biggest trade partner by state. This also gives me the opportunity to warn of some little 'gotchas': flagfillr uses the rnaturalearth package for its geographical data, and when you 

```{r}
library(dplyr)
library(flagfillr) 

oz <- tibble(
  country = "Australia",
  state = c("Northern Territory", "Western Australia", "New South Wales",
            "South Australia", "Victoria", "Queensland", "Tasmania",
            "Australian Capital Territory"),
  partner = c("India", "United Kingdom", "South Korea", "Malaysia", "New Zealand",
              "India", "Malaysia", "Malaysia")
)

flag_fillr_data(oz, country = "Australia", type = "state", 
                partner_col = oz$partner, state_col = oz$state)
```



Thanks to the handy new sf package, and its accompanying `geom_sf()` in the development version of ggplot2, we now have an easier way to manipulate dataframes of geographical information. I was able to utilise these to make a few functions that make creating 


