---
title: Hmm...where to move to? Using R & D3 to decide where to live (kind of).
author: Robert Myles McDonnell
date: '2018-03-25'
slug: hmm-where-to-move
categories: [R, D3]
tags: []
draft: true
output: html_document
  #    includes:
  #    after_body: radar_index.html
---

Myself and my wife have been thinking about where we'd like to move in the future. We have 5 cities in mind. The things that matter to us (that I could get data on, or are relevant/measurable) are the climate, crime, the cost of living, the type of salary we could get, if the city is near to the sea and beach (I like being close to the sea) and if a city is very big (large population). We live in SÃ£o Paulo, so we're kind of due a break from having *millions* of people around us all the time.  
The cost of living stats, which are relative to NY (i.e. 100 = NY), I got from [numbeo](https://www.numbeo.com/cost-of-living/rankings.jsp). Salary stats I got from Google searches, mainly leading to indeed.com (for Berlin I found only the German national average, and Lisbon is a bit of a guess, there was nothing that I found). Temperatures I found on Wikipedia, and all currency values were converted to Euro skrilla `r emo::ji("euro")`. The crime index also comes from numbeo. I put these in a tibble and rescaled all the values, inverting the winter temps so that lower ones mean higher values on the plot:   

```{r, message=FALSE, warning=FALSE, results='asis'}
library(dplyr)
library(scales)
library(jsonlite)

cities <- tibble(
  city = c("Cork", "Vancouver", "Perth", "Lisbon", "Berlin"),
  av_winter_temp = c(5.6, 3.5, 13, 11.6, 1),
  av_summer_temp = c(15.3, 18, 25, 23.5, 19.2),
  av_min_winter_temp = c(3, 1, 7.7, 8, -2),
  av_max_summer_temp = c(18.7, 22, 32.3, 28.3, 25),
  median_salary = c(55000, 60000, 60000, 45000, 52000),
  gdp_per_capita = c(50544, 36000, 45000, 30000, 35600),
  crime_index = c(29.19, 35.96, 43.93, 33.53, 40.97),
  population = c(208669, 631486, 2022044, 552700, 3700000),
  distance_to_beach = c(25, 0, 0, 0, 145),
  cost_of_living = c(82.89, 75.59, 86.24, 57.69, 74.32)
) %>% 
  #mutate_at(vars(-city),funs(rescale)) %>% 
  mutate(av_min_winter_temp = 1- av_min_winter_temp,
         av_winter_temp = 1 - av_winter_temp)

send_df_to_js <- function(df){
  cat(paste('<script>var data = ', toJSON(df),'; </script>', sep = ""))
}

send_df_to_js(cities)
```

    

<!-- Google fonts -->
<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>

<!-- D3.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
		
<style>
	.chartBody {
		font-family: 'Open Sans', sans-serif;
		font-size: 11px;
		font-weight: 300;
		fill: #242424;
		text-align: center;
		text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, -1px 0 0 #fff, 0 -1px 0 #fff;
		cursor: default;
	}
	
	.legend {
		font-family: 'Raleway', sans-serif;
		fill: #333333;
	}
	
	.tooltip {
		fill: #333333;
	}
</style>


<svg style="width:800px;height:500px;border:1px lightgray solid;"></svg>
```{js}

function dataViz(incomingData){
        var maxPopulation = d3.max(incomingData, function(el) {
            return parseInt(el.population);});
        var xScale = d3.scale.linear().domain([0,maxPopulation]).range([0,600]);

        
        d3.select("svg").attr("style","height: 500px; width: 600px;");
        
        d3.select("svg")
          .selectAll("rect")
          .data(incomingData)
          .enter()
          .append("rect")
          .attr("height", 50)
          .attr("width", function(d) {return xScale(parseInt(d.population));})
          .attr("y", function(d,i) {return i * 60;})
          .attr("x", 0)
          .style("fill", "blue")
          .style("stroke", "red")
          .style("stroke-width", "1px")
          .style("opacity", .25);
}

dataViz(data);
```

So what makes a city 'good' here? Low-to-medium values for population and cost of living, low crime and not-too-high summer temperatures, not-too-low winter temperatures, nice salaries, high GDP and short distance to the beach. None of the cities are perfect (of course not!), but ol' Cork doesn't come out too bad. Vancouver, too. Remember that the winter temperatures were inversed, so Lisbon looks great in terms of the climate, and its low cost of living. It's also by the beach, something Cork isn't exactly (although there are amazing beaches not too far away). Perth came out OK on our list, after many years of hot weather, I think I might need a break (my skin definitely does), although I'm not sure I like the cold of Berlin, or its bigger population. So which one will we choose? That'd be telling...
 
# set up data as nested list
<svg></svg>
```{js}
d3 = require("https://d3js.org/d3.v5.min.js")

margin = ({top: 30, right: 0, bottom: 10, left: 30})
height = 690

x = d3.scaleLinear()
    .domain([0, d3.max(data, d => d.crime_index)])
    .range([margin.left, width - margin.right])

y = d3.scaleBand()
    .domain(data.map(d => d.city))
    .range([margin.top, height - margin.bottom])
    .padding(0.1)

xAxis = g => g
    .attr("transform", `translate(0,${margin.top})`)
    .call(d3.axisTop(x).ticks(width / 80))
    .call(g => g.select(".domain").remove())

yAxis = g => g
    .attr("transform", `translate(${margin.left},0)`)
    .call(d3.axisLeft(y).tickSizeOuter(0))

chart = {
  const svg = d3.select(DOM.svg(width, height));
  
  svg.append("g")
    .attr("fill", "steelblue")
    .selectAll("rect")
    .data(data)
    .enter().append("rect")
      .attr("x", x(0))
      .attr("y", d => y(d.name))
      .attr("width", d => x(d.value) - x(0))
      .attr("height", y.bandwidth());
  
  svg.append("g")
    .attr("fill", "white")
    .attr("text-anchor", "end")
    .style("font", "12px sans-serif")
    .selectAll("text")
    .data(data)
    .enter().append("text")
      .attr("x", d => x(d.value) - 4)
      .attr("y", d => y(d.name) + y.bandwidth() / 2)
      .attr("dy", "0.35em")
      .text(d => formatValue(d.value));
  
  svg.append("g")
      .call(xAxis);
  
  svg.append("g")
      .call(yAxis);
  
  return svg.node();
}

```